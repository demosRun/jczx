<!DOCTYPE html>
<html lang="cn">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="./static/wow/wow.min.js"></script>
    <link rel="stylesheet" href="./static/wow/animate.css">
    <link rel="icon" type="image/x-icon" href="static/icon.png" width="200%">
    <title id="title"></title>
    <link href="css/chunk-05f97b1e.250fed8a.css" rel="prefetch">
    <link href="css/chunk-07a31a49.729cca78.css" rel="prefetch">
    <link href="css/chunk-0fc7d135.05e9bb4b.css" rel="prefetch">
    <link href="css/chunk-15ecb36f.f28262eb.css" rel="prefetch">
    <link href="css/chunk-1829546c.8bfac525.css" rel="prefetch">
    <link href="css/chunk-1c9aa491.be0341a5.css" rel="prefetch">
    <link href="css/chunk-1dc09ece.9ad8aead.css" rel="prefetch">
    <link href="css/chunk-269dc73c.7b41e6eb.css" rel="prefetch">
    <link href="css/chunk-2baed362.d1240b02.css" rel="prefetch">
    <link href="css/chunk-2c594db4.8e61df91.css" rel="prefetch">
    <link href="css/chunk-2f861b64.1eb786d1.css" rel="prefetch">
    <link href="css/chunk-3b5e0dd2.74761098.css" rel="prefetch">
    <link href="css/chunk-42eba151.bed79e90.css" rel="prefetch">
    <link href="css/chunk-440bceaf.d41dd90a.css" rel="prefetch">
    <link href="css/chunk-5190ee02.0b994f68.css" rel="prefetch">
    <link href="css/chunk-54984aa6.b8efc2b6.css" rel="prefetch">
    <link href="css/chunk-56896905.b4bfea2d.css" rel="prefetch">
    <link href="css/chunk-591b946c.898ac6a4.css" rel="prefetch">
    <link href="css/chunk-6b11e2f8.09079df9.css" rel="prefetch">
    <link href="css/chunk-6ec0e61f.e52d0615.css" rel="prefetch">
    <link href="css/chunk-7350a096.9879c252.css" rel="prefetch">
    <link href="css/chunk-75789bdc.e45b99f9.css" rel="prefetch">
    <link href="css/chunk-8d814e5e.0addea59.css" rel="prefetch">
    <link href="css/chunk-8f40ebcc.a8f3cc85.css" rel="prefetch">
    <link href="css/chunk-9ec1816c.d64a30b6.css" rel="prefetch">
    <link href="css/chunk-a900dff0.acf41519.css" rel="prefetch">
    <link href="css/chunk-b61cf8ec.5db6c9eb.css" rel="prefetch">
    <link href="css/chunk-b86620a8.5198cbe4.css" rel="prefetch">
    <link href="css/chunk-beea083e.83ab61a7.css" rel="prefetch">
    <link href="css/chunk-d8225f9c.6baab1eb.css" rel="prefetch">
    <link href="css/chunk-e2f49afa.1ce32c1e.css" rel="prefetch">
    <link href="css/chunk-fbd80d44.53f946c1.css" rel="prefetch">
    <link href="js/chunk-05f97b1e.ebe164b2.js" rel="prefetch">
    <link href="js/chunk-07a31a49.7ce26778.js" rel="prefetch">
    <link href="js/chunk-0fc7d135.170276b1.js" rel="prefetch">
    <link href="js/chunk-15ecb36f.ad004e9e.js" rel="prefetch">
    <link href="js/chunk-1829546c.67230200.js" rel="prefetch">
    <link href="js/chunk-1c9aa491.f605e055.js" rel="prefetch">
    <link href="js/chunk-1dc09ece.e6f64054.js" rel="prefetch">
    <link href="js/chunk-269dc73c.6fdb88be.js" rel="prefetch">
    <link href="js/chunk-2baed362.fdd097a4.js" rel="prefetch">
    <link href="js/chunk-2c594db4.a8f5aa40.js" rel="prefetch">
    <link href="js/chunk-2d225874.12cb665e.js" rel="prefetch">
    <link href="js/chunk-2f861b64.32e6db1c.js" rel="prefetch">
    <link href="js/chunk-3b5e0dd2.c769b098.js" rel="prefetch">
    <link href="js/chunk-42eba151.f95753ff.js" rel="prefetch">
    <link href="js/chunk-440bceaf.20c2a2e2.js" rel="prefetch">
    <link href="js/chunk-5190ee02.8e3af439.js" rel="prefetch">
    <link href="js/chunk-54984aa6.77eaa79e.js" rel="prefetch">
    <link href="js/chunk-56896905.317a4c70.js" rel="prefetch">
    <link href="js/chunk-591b946c.58083433.js" rel="prefetch">
    <link href="js/chunk-6b11e2f8.39a384f6.js" rel="prefetch">
    <link href="js/chunk-6caf4e9c.8df24baf.js" rel="prefetch">
    <link href="js/chunk-6ec0e61f.6a06a0ae.js" rel="prefetch">
    <link href="js/chunk-7350a096.5158b74a.js" rel="prefetch">
    <link href="js/chunk-75789bdc.5221d029.js" rel="prefetch">
    <link href="js/chunk-8d814e5e.b679ee0f.js" rel="prefetch">
    <link href="js/chunk-8f40ebcc.9b462743.js" rel="prefetch">
    <link href="js/chunk-9ec1816c.1a24c289.js" rel="prefetch">
    <link href="js/chunk-a900dff0.75aa14fe.js" rel="prefetch">
    <link href="js/chunk-b61cf8ec.78ed1d32.js" rel="prefetch">
    <link href="js/chunk-b86620a8.8faecceb.js" rel="prefetch">
    <link href="js/chunk-beea083e.0e7a1a74.js" rel="prefetch">
    <link href="js/chunk-d8225f9c.01b32570.js" rel="prefetch">
    <link href="js/chunk-e2f49afa.fd4780bc.js" rel="prefetch">
    <link href="js/chunk-fbd80d44.8702a5f9.js" rel="prefetch">
    <link href="css/app.84c47f99.css" rel="preload" as="style">
    <link href="css/chunk-vendors.6b92dc4c.css" rel="preload" as="style">
    <link href="js/app.3159edc5.js" rel="preload" as="script">
    <link href="js/chunk-vendors.e4449403.js" rel="preload" as="script">
    <link href="css/app.84c47f99.css" rel="stylesheet">
    <link href="css/chunk-vendors.6b92dc4c.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cunchu.site/work/login/standard.css">
    <script src="https://cunchu.site/work/login/standard.js" type="text/javascript" charset="UTF-8"></script>
    <script src="https://cunchu.site/work/assist/logPanel.js" type="text/javascript" charset="UTF-8"></script>
    <style>
      .mini-input {
        width: 40px;
        border: none;
        border-radius: 5px;
        background-color: gray;
        color: white;
        height: 22px;
        text-align: center;
        margin-right: 5px;
      }
      .transCCCopy_new_NewFooter_tabs_head .head_r .head_l_btns {
        font-size: 14px !important;
      }
      .transCC-box7.transCC-box .transCCCopy_new_NewFooter_trade .qjfk {
        background-color: deepskyblue !important;
        color: white !important;
      }
      .owo .button {
        background: #009fe9;
        border: none;
      }
      .owo .button:hover {
        background: #009fe9;
        background-color: #009fe9;
      }
      .base_footer_NewFooter-footerBox .trade_btn {
        background-color: #009fe9;
        color: white;
        padding: 0px 10px;
        line-height: 26px;
        margin: 0 5px;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
      }
      #app {
        overflow: visible;
      }
      .base_footer_NewFooter-footerBox span {
        margin-right: 5px;
      }
      .popup-panel.cd-popup-container {
        max-height: 660px;
      }
      .popup-panel.cd-popup-container .conn {
        max-height: 600px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <script>let title = document.getElementById('title')
      // let localeLanguage = localStorage.lang||navigator.language.slice(-2).toLowerCase();
      localStorage.lang = 'cn';
      let localeLanguage = 'cn';
      switch (localStorage.lang) {
      case "en":
        title.innerHTML = window.g.APP_TITLE_ALL;
        break;
      case "tw":
        title.innerHTML = window.g.APP_TITLE_ALL;
        break;
      default:
        break;
      }</script>
    <noscript>
      <strong>We're sorry but tq_swaps_pcclient doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript>
    <div id="app"></div>
    <script src="./moment.js"></script>
    <script src="./moment-timezone.js"></script>
    <script src="js/app.3159edc5.js"></script>
    <script src="js/chunk-vendors.e4449403.js"></script>
    
    <script>
      function getHeaders () {
        return {
          "accept": "application/json, text/plain, */*",
          "accept-language": "cn",
          "cache-control": "no-cache",
          "content-type": "application/json;charset=UTF-8",
          "firmid": sessionStorage.getItem('firmId'),
          "language": "ZH",
          "marketid": "28",
          "pragma": "no-cache",
          "sec-ch-ua": "\"Not)A;Brand\";v=\"99\", \"Google Chrome\";v=\"127\", \"Chromium\";v=\"127\"",
          "sec-ch-ua-mobile": "?0",
          "sec-ch-ua-platform": "\"Windows\"",
          "sec-fetch-dest": "empty",
          "sec-fetch-mode": "cors",
          "sec-fetch-site": "cross-site",
          "sessionstr": sessionStorage.getItem('sessionStr'),
          "terminaltype": localStorage.getItem("equipmentFlag_PC")||4,
          "userid": sessionStorage.getItem('userId')
        }
      }
      // 查询委托
      function cxwt (callBack) {
        fetch("https://yw.ceramic-copyright.cn/apigateway/intraday-trade-query-mongo/tradeQuery/queryOrderNewFront", {
          "headers": getHeaders(),
          "referrerPolicy": "strict-origin-when-cross-origin",
          "body": JSON.stringify({"page":0,"size":"6","bsFlag":null,"orderType":null,"sort":[{"direction":"DESC","property":"orderId"}],"firmId":"373234","commodityId":null,"orderStatus":[1,4]}),
          "method": "POST",
        }).then((response) => response.json())
          .then((result) => {
            window['当前委托'] = result.value.content
            window['当前委托数'] = result.value.content.length
            logBox.add(`当前委托数量【${window['当前委托数']}】`)
            if (callBack) callBack(result.value.content)
          })
          .catch((error) => console.error(error));
      }
      window.lastPriceTemp = []
      window.lastPriceTime = Math.round(new Date() / 1000)
      window.isBusy = false
      // 下单
      function tradeMake (bsFlag, price, quantity) {
        if (window.isBusy) return
        if (!Store['自动交易开启']) return
        if ((window['当前委托数'] + window['当前持仓数']) >= parseInt(Store['开单次数'])) {
          return
        }
        if (Store['首单开仓方式'] == '标准k线开仓') {
          if (window['标线类型'] !== '标准K线') {
            // window.logBox.add(`当前非标准K线，忽略下单!`)
            return
          }
        }
        price = price || document.querySelector('#jiage').value
        if (!quantity) {
          quantity = 1
          if (Store['开单手数']) {
            Store['开单手数'] = Store['开单手数'].replaceAll('：', ':')
            let orderNumberTemp = Store['开单手数'].split(':')
            if (orderNumberTemp[window['当前持仓数']]) quantity = orderNumberTemp[window['当前持仓数']]
            else quantity = orderNumberTemp[orderNumberTemp.length - 1]
          }
        }
        quantity = quantity || document.querySelector('#shuliang').value
        if (window.Store['策略方向'] == '单多' && bsFlag == 'S') {
          // window.logBox.add(`因为设置策略【单多】忽略卖出单!`)
          return
        }
        // 判断秒数是否在50秒以内
        if (new Date().getSeconds() < 52) {
          return
        }
        if (window.Store['策略方向'] == '单空' && bsFlag == 'B') {
          // window.logBox.add(`因为设置策略【单空】忽略买入单!`)
          return
        }
        if (Store['同价格不重复下单'] == true && (window.lastPriceTemp.includes(parseInt(price)) || window.lastPriceTemp.includes(String(price)))) {
          window.logBox.add(`因为设置策略【同价格不重复下单】忽略下单!`)
          return
        }
        window.lastPriceTemp.push(price)
        // window.logBox.add(JSON.stringify(window.lastPriceTemp))
        if (Math.round(new Date() / 1000) - window.lastPriceTime < 5) {
          // window.logBox.add(`忽略频繁下单 剩余[${60 - (Math.round(new Date() / 1000) - window.lastPriceTime)}]秒!`)
          return
        }
        window.lastPriceTime = Math.round(new Date() / 1000)
        
        // window.logBox.add(`下单 ${bsFlag} ${price} ${quantity}`)
        
        if (Store['交易频次'] == '单次策略') {
          window.logBox.add(`因为【单次策略原因】自动下单已停止!`)
          Store['自动交易开启'] = false
          localStorage.setItem('Store', JSON.stringify(window.Store))
          setTimeout(() => {
            loadStore()
          }, 200);
        }
        window.isBusy = true
        setTimeout(() => {
          window.isBusy = false
        }, 10000);
        fetch("https://yw.ceramic-copyright.cn/apigateway/intraday-trade/trade/make", {
          "headers": getHeaders(),
          "referrerPolicy": "strict-origin-when-cross-origin",
          "body": JSON.stringify({"bsFlag":bsFlag,"commodityId":"424","price":price,"quantity":quantity}),
          "method": "POST",
        }).then((response) => response.json())
          .then((result) => {
            window['当前委托数'] ++
            if (Store['定时清理委托']) {
              setTimeout(() => {
                qlwt()
              }, 30 * 1000);
            }
            window.lastPriceTemp.push(price)
            window.logBox.add(`下单 ${bsFlag} ${price} ${quantity}: ${result.message} 已下单数量:${window['当前委托数'] + window['当前持仓数']}`)
            console.log(result)
          })
          .catch((error) => console.error(error));
      }
      // 持单明细
      function cdmx(callBack) {
        let url = "https://yw.ceramic-copyright.cn/apigateway/intraday-trade-query-mongo/tradeQuery/queryHoldDetailNewList"
        if (Store['止损方式'] == '全仓止损') {
          url = "https://yw.ceramic-copyright.cn/apigateway/intraday-trade-query-mongo/tradeQuery/queryHoldNewFront"
        }
        fetch(url, {
          "headers": getHeaders(),
          "referrerPolicy": "strict-origin-when-cross-origin",
          "body": JSON.stringify({"page":0,"size":"60","sort":[{"direction":"DESC","property":"holdDetailId"}],"bsFlag":null,"commodityId":null,"holdPlType":null}),
          "method": "POST",
        }).then((response) => response.json())
          .then((result) => {
            window['当前持仓'] = result.value.content
            window['当前持仓数'] = result.value.content.length
            window['当前持仓总收益'] = 0
            window.lastPriceTemp = []
            result.value.content.forEach(element => {
              window.lastPriceTemp.push(element.singlePrice)
            });
            if (window['当前持仓总收益'] / window['可用资金'] > (parseInt(Store['盈利达到数值']) / 100)) {
              logBox.add('满足条件 [盈利达到A%停止] 下单已停止!')
              Store['自动交易开启'] = false
            }
            if (window['当前持仓总收益'] / window['可用资金'] < -(parseInt(Store['亏损达到数值']) / 100)) {
              logBox.add('满足条件 [亏损达到B%停止] 下单已停止!')
              Store['自动交易开启'] = false
            }
            logBox.add(`当前持仓数量【${window['当前持仓数']}】`)
            if (callBack) callBack(result.value.content)
          })
          .catch((error) => console.error(error));
      }
      // 平仓
      function pingcang(item, price, quantity) {
        let holdDetailId = item.holdDetailId
        let holdId = item.holdId
        // 判断秒数是否在50秒以内
        if (new Date().getSeconds() < 52) {
          return
        }
        // if ((Math.round(new Date() / 1000) - window.lastPriceTime) < 5) {
        //   window.logBox.add(`忽略频繁平仓 剩余[${60 - (Math.round(new Date() / 1000) - window.lastPriceTime)}]秒!`)
        //   return
        // }
        window.lastPriceTime = Math.round(new Date() / 1000)
        // if (!Store['自动交易开启']) return
        window['当前委托数']--
        if (Store['止损方式'] == '全仓止损') {
          fetch("https://yw.ceramic-copyright.cn/apigateway/intraday-trade/trade/holdTransfer", {
            "headers": getHeaders(),
            "referrerPolicy": "strict-origin-when-cross-origin",
            "body": JSON.stringify({"holdId":holdId,"price":price,"quantity":item.quantity}),
            "method": "POST",
          }).then((response) => response.json())
            .then((result) => {
              logBox.add(`平仓: [${holdId} ${price} ${item.quantity}]`)
            })
            .catch((error) => console.error(error));
        } else {
          fetch("https://yw.ceramic-copyright.cn/apigateway/intraday-trade/trade/transfer", {
            "headers": getHeaders(),
            "referrerPolicy": "strict-origin-when-cross-origin",
            "body": JSON.stringify({"holdDetailId":holdDetailId,"price":price,"quantity":item.quantity}),
            "method": "POST",
          }).then((response) => response.json())
            .then((result) => {
              logBox.add(`平仓: [${holdDetailId} ${price} ${item.quantity}]`)
            })
            .catch((error) => console.error(error));
        }
      }
      function pingcangsuoyou (bsFlag) {
        cdmx(list => {
          list.forEach(item => {
            if (item.bsFlag == bsFlag) pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
          })
        })
      }
      function getLastPriceInfo () {
        if (!window['价格信息']['avgPrice'] || window['价格信息']['avgPrice'][0] === '') {
          return {
            "avgPrice": "",
            "barVolume": "",
            "barVolumeOffZero": "",
            "datatype": "",
            "index": "",
            "lastPrice": "",
            "priceArr": "",
            "times": "",
            "vol": "",
          }
        }
        for (let index = 0; index < window['价格信息']['avgPrice'].length; index++) {
          const element = window['价格信息']['avgPrice'][index];
          if (element === '') {
            return {
              "avgPrice": window['价格信息']['avgPrice'][index - 1],
              "barVolume": window['价格信息']['barVolume'][index - 1],
              "barVolumeOffZero": window['价格信息']['barVolumeOffZero'][index - 1],
              "datatype": window['价格信息']['datatype'][index - 1],
              "index": window['价格信息']['index'][index - 1],
              "lastPrice": window['价格信息']['lastPrice'][index - 1],
              "priceArr": window['价格信息']['priceArr'][index - 1],
              "times": window['价格信息']['times'][index - 1],
              "vol": window['价格信息']['vol'][index - 1],
            }
          }
        }
        return {
          "avgPrice": window['价格信息']['avgPrice'][window['价格信息']['avgPrice'].length - 1],
          "barVolume": window['价格信息']['barVolume'][window['价格信息']['avgPrice'].length - 1],
          "barVolumeOffZero": window['价格信息']['barVolumeOffZero'][window['价格信息']['avgPrice'].length - 1],
          "datatype": window['价格信息']['datatype'][window['价格信息']['avgPrice'].length - 1],
          "index": window['价格信息']['index'][window['价格信息']['avgPrice'].length - 1],
          "lastPrice": window['价格信息']['lastPrice'][window['价格信息']['avgPrice'].length - 1],
          "priceArr": window['价格信息']['priceArr'][window['价格信息']['avgPrice'].length - 1],
          "times": window['价格信息']['times'][window['价格信息']['avgPrice'].length - 1],
          "vol": window['价格信息']['vol'][window['价格信息']['avgPrice'].length - 1],
        }
      }
    </script>
    <script>
      window['已开单次数'] = 0
      window['当前委托数'] = 999
      window['当前持仓数'] = 999
      window['持仓收益'] = []
      owo.tool.panelBox('<div class="log-panel" style="width:380px;height:300px;"></div>', '日志:', (val) => {
        // console.log(val)
        window.logBox = new logPanel(document.querySelector('.log-panel'))
      })
      function checkBXLXSL(data, yystr) {
        let returnNum = 0
        for (let index = data.length - 1; index > 0; index--) {
          let 标线阴阳 = data[index][5] - data[index][2] > 0 ? '阳线' : '阴线'
          if (标线阴阳 == yystr) returnNum++
          else break
        }
        return returnNum
      }
      window.owoCallBack = function (key, value) {
        // console.log('222', value)
        switch (key) {
          case 'RequestMinuteRealtimeData':
            // 自动统计早盘9：30-11:30的最低点最高点价格的价差，形成早盘区间实时数据
            let 早盘数据 = []
            let 当天数据 = []
            let 涨数 = 0
            let 跌数 = 0
            let 总价 = 0
            let 总数 = 0
            console.log(value.data[value.data.length - 1])
            window['开盘价'] = value.data[value.data.length - 1][2]
            window['最高价'] = value.data[value.data.length - 1][3]
            window['最低价'] = value.data[value.data.length - 1][4]
            window['收盘价'] = value.data[value.data.length - 1][5]
            window['当前价'] = window['收盘价']
            window['标线类型'] = '非标准k线'
            window['标线连续'] = checkBXLXSL(value.data, window['标线阴阳'])
            window['标线阴阳'] = window['收盘价'] - window['开盘价'] > 0 ? '阳线' : '阴线'
            if (!window['标线阴阳列表']) window['标线阴阳列表'] = []
            window['标线阴阳列表'].push(window['标线阴阳'])
            if (window['收盘价'] == window['最低价'] || window['收盘价'] == window['最高价']) {
              // logBox.add(`非标准K线，当前价为开盘价!`)
              window['当前价'] = window['开盘价']
            }
            if (Math.abs(window['开盘价'] - window['收盘价']) == 1 && Math.abs(window['最高价'] - window['最低价']) == 3) {
              window['标线类型'] = "标准K线"
            }
            document.querySelector('.panel-box .title-text').innerText = `${window['标线类型']} ${window['标线阴阳']} 连续次数:${window['标线连续']}`
            for (let index = 0; index < value.data.length; index++) {
              const element = value.data[index];
              const unixTimestamp = parseInt(element[0] / 1000); // 例如的时间戳

              const timestampMoment = moment.unix(unixTimestamp).tz('Asia/Shanghai');

              // 获取当前日期的北京时间9:30和11:30的时间点
              const startOfPeriod = moment().tz('Asia/Shanghai').set({ hour: 9, minute: 30, second: 0, millisecond: 0 });
              const endOfPeriod = moment().tz('Asia/Shanghai').set({ hour: 11, minute: 30, second: 0, millisecond: 0 });

              // 值判断当天的

              // 计算与当前时间的天数差
              if (moment().diff(moment.unix(element[0] / 1000), 'days') < 1) {
                当天数据.push(element)
              }
              if (timestampMoment.isBetween(startOfPeriod, endOfPeriod)) {
                
                早盘数据.push(element)
                // console.log(111, moment.unix(unixTimestamp).tz('Asia/Shanghai').format('YYYY-MM-DD HH:mm:ss')); // 输出 true 或 false
              }
              if (value.data[index - 1]) {
                if (element[5] > value.data[index - 1][5]) {
                  涨数++
                } else {
                  跌数 ++
                }
              }
            }
            // 判断早盘最小值和最大值
            // 提取每个子数组的第五项
            const fifthItems = 早盘数据.map(subArray => subArray[5]);
            const fifthItems2 = 当天数据.map(subArray => subArray[5]);
            const fifthItems3 = 当天数据.map(subArray => subArray[6]);
            // 找到这些值中的最小值
            const 早盘数据min = Math.min(...fifthItems);
            const 早盘数据max = Math.max(...fifthItems);
            const 当日数据min = Math.min(...fifthItems2);
            const 当日数据max = Math.max(...fifthItems2);
            if (!document.querySelector('.transCCCopy_new_NewFooter_header_l')) {
              return
            }
            // 判断是否有早盘数据
            if (document.querySelector('.transCCCopy_new_NewFooter_header_l .zpsj')) {
              document.querySelector('.transCCCopy_new_NewFooter_header_l .zpsj').innerHTML = `
              <div class="header_l_item_name">早低</div>
              <div class="header_l_item_v"> ${早盘数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
              <div class="header_l_item_name">早高</div>
              <div class="header_l_item_v"> ${早盘数据max}<span style="color: rgb(255, 255, 255);">元</span></div>
              <div class="header_l_item_name">早差</div>
              <div class="header_l_item_v"> ${早盘数据max - 早盘数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
              <div class="header_l_item_name">日低</div>
              <div class="header_l_item_v"> ${当日数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
              <div class="header_l_item_name">日高</div>
              <div class="header_l_item_v"> ${当日数据max}<span style="color: rgb(255, 255, 255);">元</span></div>
              <div class="header_l_item_name">日差值</div>
              <div class="header_l_item_v"> ${当日数据max - 当日数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
              <div class="header_l_item_name">阳线</div>
              <div class="header_l_item_v"> ${涨数}</div>
              <div class="header_l_item_name">阴线</div>
              <div class="header_l_item_v"> ${跌数}</div>
              <div class="header_l_item_name">阴/阳</div>
              <div class="header_l_item_v"> ${(跌数 / 涨数).toFixed(2)}</div>
              `
              
            } else {
              document.querySelector('.transCCCopy_new_NewFooter_header_l').innerHTML += `
              <div class="header_l_item zpsj">
                <div class="header_l_item_name">早低</div>
                <div class="header_l_item_v"> ${早盘数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
                <div class="header_l_item_name">早高</div>
                <div class="header_l_item_v"> ${早盘数据max}<span style="color: rgb(255, 255, 255);">元</span></div>
                <div class="header_l_item_name">早差</div>
                <div class="header_l_item_v"> ${早盘数据max - 早盘数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
                <div class="header_l_item_name">日低</div>
                <div class="header_l_item_v"> ${当日数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
                <div class="header_l_item_name">日高</div>
                <div class="header_l_item_v"> ${当日数据max}<span style="color: rgb(255, 255, 255);">元</span></div>
                <div class="header_l_item_name">日差</div>
                <div class="header_l_item_v"> ${当日数据max - 当日数据min}<span style="color: rgb(255, 255, 255);">元</span></div>
                <div class="header_l_item_name">阳线</div>
                <div class="header_l_item_v"> ${涨数}</div>
                <div class="header_l_item_name">阴线</div>
                <div class="header_l_item_v"> ${跌数}</div>
                <div class="header_l_item_name">阴/阳</div>
                <div class="header_l_item_v"> ${(跌数 / 涨数).toFixed(2)}</div>
              </div>`
            }
            xiadan()
            break;
          case 'queryTradeClosepl':
            console.log(value)
            window['可用资金'] = value.fuAccountFunds.lastBalance
            window['当前持仓总收益'] = value.fuAccountFunds.balance - value.fuAccountFunds.lastBalance
            break;
          default:
            break;
        }
      }
      setInterval(() => {
        // if (document.querySelector('.transCCCopy_new_NewFooter_tabs_head .head_r') && !document.querySelector('.transCCCopy_new_NewFooter_tabs_head .head_r .szbutton')) {
        //   document.querySelector('.transCCCopy_new_NewFooter_tabs_head .head_r').innerHTML += `<input class="mini-input" type="input"><div class="head_l_btns szbutton">指定价做多</div><div class="head_l_btns szbutton">平仓所有空单</div><input class="mini-input" type="input"><div class="head_l_btns szbutton">指定价做空</div><div class="head_l_btns szbutton">平仓所有多单</div>`
        // }
        if (document.querySelector('.base_footer_NewFooter-footerBox') && !document.querySelector('.base_footer_NewFooter-footerBox .qjfk')) {
          document.querySelector('.base_footer_NewFooter-footerBox').innerHTML += `<div onclick="qszb()" class="trade_btn trade_btn_left trade_sell_btn qszb">趋势策略</div><div onclick="qjfktc()" class="trade_btn trade_btn_left trade_sell_btn qjfk">下单策略</div><div onclick="风控面板()" class="trade_btn trade_btn_left trade_sell_btn qjfk">平仓策略</div><span>价格</span><input id="jiage" class="mini-input" value="100" type="number"><div onclick="dqjg()" class="trade_btn szbutton">当前价格</div><span>数量</span><input id="shuliang" class="mini-input" type="number" value="1"><div onclick="tradeMake('B')" class="trade_btn szbutton">指定价做多</div><div class="trade_btn szbutton" onclick="pingcangsuoyou('B')">平仓所有多单</div><div onclick="tradeMake('S')" class="trade_btn szbutton">指定价做空</div><div class="trade_btn szbutton" onclick="pingcangsuoyou('S')">平仓所有空单</div><div class="trade_btn szbutton" onclick="cdmx()">持仓明细</div><label onclick="saveStore();" class="owo bar"><span>自动交易开启</span><input type="checkbox" class="ios-switch  bigswitch" storeName="自动交易开启"><div><div></div></div>
        </label>`
        }
      }, 1000);
      window.Store = {}
      if (localStorage.getItem('Store')) {
        window.Store = JSON.parse(localStorage.getItem('Store'))
      }
      function saveStore () {
        document.querySelectorAll('[storeName]').forEach(element => {
          if (element.tagName == 'INPUT' && element.getAttribute('type') == 'checkbox') {
            window.Store[element.getAttribute('storeName')] = element.checked
          } else {
            window.Store[element.getAttribute('storeName')] = element.value
          }
        });
        localStorage.setItem('Store', JSON.stringify(window.Store))
        // alert('保存成功!')
      }
      function loadStore () {
        if (localStorage.getItem('Store')) {
          window.Store = JSON.parse(localStorage.getItem('Store'))
        }
        document.querySelectorAll('[storeName]').forEach(element => {
          if (window.Store[element.getAttribute('storeName')] !== undefined && window.Store[element.getAttribute('storeName')] !== null) {
            if (element.tagName == 'INPUT' && element.getAttribute('type') == 'checkbox') {
              
              element.checked = window.Store[element.getAttribute('storeName')]
            } else {
              element.value = window.Store[element.getAttribute('storeName')]
            }
          }
        });
      }
      function 风控面板 () {
        owo.tool.panel(`
        <h4>止损点位</h4>
        <select switchControl="止损点位选择" storeName="止损点位">
          <option value="只手动卖出">只手动卖出</option>
          <option value="亏损达到X卖出">亏损达到X卖出</option>
          <option value="亏损比例X卖出">亏损比例X卖出</option>
          <option value="固定金额止损">固定金额止损</option>
        </select>
        <h4>止损方式</h4>
        <select switchControl="止损方式" storeName="止损方式">
          <option value="每单单独止损">每单单独止损</option>
          <option value="全仓止损">全仓止损</option>
          <option value="首单全仓止损">首单全仓止损</option>
          <option value="手动止损">手动止损</option>
        </select>
        <h4>止盈点位</h4>
        <select switchControl="止盈点位选择" storeName="止盈点位">
          <option value="只手动卖出">只手动卖出</option>
          <option value="盈利达到X卖出">盈利达到X卖出</option>
          <option value="盈利比例X卖出">盈利比例X卖出</option>
          <option value="固定金额止盈">固定金额止盈</option>
          <option value="移动止盈">移动止盈</option>
        </select>
        <h4>止盈方式</h4>
        <select switchControl="止盈方式" storeName="止盈方式">
          <option value="每单单独止盈">每单单独止盈</option>
          <option value="全仓止盈">全仓止盈</option>
          <option value="首单全仓止赢">首单全仓止赢</option>
          <option value="手动止盈">手动止盈</option>
        </select>
        <h4 switch-止盈点位选择="移动止盈">移动止盈数值填2或者1:2:4形式</h4>
        <input type="text" value="2" switch-止盈点位选择="移动止盈" storeName="移动止盈数值">
        <h4 switch-止盈点位选择="盈利达到X卖出">盈利数值设置</h4>
        <input type="number" value="100" switch-止盈点位选择="盈利达到X卖出" storeName="固定点位止盈">
        <h4 switch-止盈点位选择="盈利比例X卖出">盈利比例设置</h4>
        <input type="number" value="10" switch-止盈点位选择="盈利比例X卖出" storeName="盈利比例卖出数值">
        <h4 switch-止盈点位选择="固定金额止盈">止盈金额设置</h4>
        <input type="number" value="100" switch-止盈点位选择="固定金额止盈" storeName="固定止盈金额设置">
        <h4 switch-止损点位选择="亏损达到X卖出">亏损数值设置</h4>
        <input type="number" value="-100" switch-止损点位选择="亏损达到X卖出" storeName="固定点位止损">
        <h4 switch-止损点位选择="亏损比例X卖出">亏损比例设置</h4>
        <input type="number" value="-10" switch-止损点位选择="亏损比例X卖出" storeName="亏损比例卖出数值">
        <h4 switch-止损点位选择="固定金额止损">止损金额设置</h4>
        <input type="number" value="100" switch-止损点位选择="固定金额止损" storeName="固定止损金额止损">
        <div class="owo button" onclick="saveStore();">保存</div>`, '平仓策略:', (val) => {
          loadStore()
          setTimeout(() => {
            initSwitchControl()
          }, 200);
        })
      }
      function qjfktc () {
        owo.tool.panel(`
        <h4>首单开仓方式</h4>
        <select storeName="首单开仓方式">
          <option value="所有k线开仓">所有k线开仓</option>
          <option value="标准k线开仓">标准k线开仓</option>
        </select>
        <h4>交易频次</h4>
        <select switchControl="交易频次选择" storeName="交易频次">
          <option value="单次策略">单次策略</option>
          <option value="循环策略">循环策略</option>
        </select>
        <h4 switch-交易频次选择="循环策略">盈利达到A%停止</h4>
        <input type="number" switch-交易频次选择="循环策略" value="" storeName="盈利达到数值">
        <h4 switch-交易频次选择="循环策略">亏损达到B%停止</h4>
        <input type="number" switch-交易频次选择="循环策略" value="" storeName="亏损达到数值">
        <h4>策略方向</h4>
        <select storeName="策略方向">
          <option value="多空双开">多空双开</option>
          <option value="单多">单多</option>
          <option value="单空">单空</option>
        </select>
        <label class="owo bar">
          <span>同价格不重复下单</span>
          <input type="checkbox" class="ios-switch  bigswitch" storeName="同价格不重复下单" checked=""><div><div></div></div>
        </label>
        
        <h4>开单次数</h4>
        <input type="number" value="1" storeName="开单次数">
        <h4>开单比例（填数字1或1:2:3这种形式）</h4>
        <input type="text" value="1" storeName="开单手数">
        <h4>开单价差</h4>
        <input type="text" value="0" storeName="开单价差">
        <div class="owo button" onclick="saveStore();">保存</div>`, '下单策略:', (val) => {
          loadStore()
          setTimeout(() => {
            initSwitchControl()
          }, 200);
        })
      }
      function qszb () {
        owo.tool.panel(`
        <h4>趋势指标选择</h4>
        <select switchControl="趋势指标选择" storeName="趋势指标选择">
          <option value="均线">均线</option>
          <option value="实时开仓">实时开仓</option>
          
        </select>
        <h4>趋势周期</h4>
        <select storeName="趋势周期">
          <option value="1">1分钟</option>
          <option value="5">5分钟</option>
          <option value="10">10分钟</option>
          <option value="15">15分钟</option>
          <option value="30">30分钟</option>
        </select>
        <h4 switch-趋势指标选择="实时开仓">实时开仓方式</h4>
        <select switch-趋势指标选择="实时开仓" storeName="实时开仓方式">
          <option value="阴线开空">阴线开空</option>
          <option value="阴线开多">阴线开多</option>
          <option value="阳线开空">阳线开空</option>
          <option value="阳线开多">阳线开多</option>
          <option value="1阴1阳开多">1阴1阳开多</option>
          <option value="1阴2阳开多">1阴2阳开多</option>
          <option value="1阳1阴开空">1阳1阴开空</option>
          <option value="1阳2阴开空">1阳2阴开空</option>
        </select>
        <h4 switch-趋势指标选择="实时开仓">多少次连续时下单</h4>
        <input type="number" value="5" switch-趋势指标选择="实时开仓" storeName="多少次连续时下单">
        <h4 switch-趋势指标选择="均线">均线</h4>
        <select switch-趋势指标选择="均线" storeName="均线">
          <option value="k线在均线上方做多">k线在均线上方做多</option>
          <option value="k线在均线上方做空">k线在均线上方做空</option>
          <option value="k线在均线下方做多">k线在均线下方做多</option>
          <option value="k线在均线下方做空">k线在均线下方做空</option>
        </select>
        <h4 switch-趋势指标选择="开仓信号">开仓信号</h4>
        <select switch-趋势指标选择="开仓信号" storeName="开仓信号">
          <option value="红色做多">红色做多</option>
          <option value="绿色做空">绿色做空</option>
        </select>
        <h4 switch-趋势指标选择="多空线">多空线</h4>
        <select switch-趋势指标选择="多空线" storeName="多空线">
          <option value="金叉后做多">金叉后做多</option>
          <option value="死叉后做空">死叉后做空</option>
        </select>
        <label class="owo bar">
          <span>显示详细日志</span>
          <input type="checkbox" class="ios-switch  bigswitch" storeName="显示详细日志" checked=""><div><div></div></div>
        </label>
        <label class="owo bar">
          <span>定时清理委托</span>
          <input type="checkbox" class="ios-switch  bigswitch" storeName="定时清理委托" checked=""><div><div></div></div>
        </label>
        <div class="owo button" onclick="saveStore();">保存</div>`, '趋势策略:', (val) => {
          loadStore()
          setTimeout(() => {
            initSwitchControl()
          }, 200);
        })
      }
      function dqjg () {
        window.jiage.value = document.querySelector('.good_msg_v').innerText
      }
      // 选择框切换隐藏
      function initSwitchControl() {
        document.querySelectorAll('[switchControl]').forEach((el) => {
          const switchControlName = el.getAttribute('switchControl')
          function changeFun () {
            document.querySelectorAll(`[switch-${switchControlName}]`).forEach(el2 => {
              const switchItemName = el2.getAttribute('switch-' + switchControlName)
              if (switchItemName == el.value) {
                el2.style.display = 'block'
              } else {
                el2.style.display = 'none'
              }
            });
          }
          el.addEventListener('change', () => {
            changeFun()
          })
          changeFun()
        })
      }
      function xiadan () {
        console.log('sdsd')
        if (!getLastPriceInfo()) return
        let 当前均价 = getLastPriceInfo()['avgPrice']
        if (Store['止盈点位'] === '盈利达到X卖出' && window['当前持仓数'] > 0) {
          cdmx((list) => {
            if (Store['止盈方式'] == '首单全仓止赢') {
              let item = list[list.length - 1]
              let 持仓成本 = item.singlePrice 
              let tempValue = parseInt(window['当前价']) - parseInt(持仓成本)
              // 做空
              if (item.bsFlag == 'S') tempValue = -tempValue
              if (tempValue >= Store['固定点位止盈']) {
                list.forEach((item2) => {
                  logBox.add(`满足自动卖出要求【首单全仓止赢】`)
                  pingcang(item2, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                })
              }
              return
            }
            list.forEach((item) => {
              let 持仓成本 = item.singlePrice 
              let tempValue = parseInt(window['当前价']) - parseInt(持仓成本)
              // 做空
              if (item.bsFlag == 'S') tempValue = -tempValue
              if (tempValue >= Store['固定点位止盈']) {
                // 判断止盈方式
                if (Store['止盈方式'] == '每单单独止盈') {
                  logBox.add(`满足自动卖出要求【持仓成本: ${持仓成本}】- 当前价: ${window['当前价']}】> ${Store['固定点位止盈']} 自动卖出!`)
                  // 平仓单独的
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
                if (Store['止盈方式'] == '全仓止盈') {
                  list.forEach((item2) => {
                    logBox.add(`满足自动卖出要求【全仓止盈】`)
                    pingcang(item2, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                  })
                }
              }
            })
          })
        }
        if (Store['止盈点位'] === '盈利比例X卖出' && window['当前持仓数'] > 0) {
          cdmx((list) => {
            if (Store['止盈方式'] == '首单全仓止赢') {
              let item = list[list.length - 1]
              let 持仓成本 = item.singlePrice 
              let tempValue = (parseInt(持仓成本) - parseInt(window['当前价'])) / parseInt(持仓成本)
              // 做空
              if (item.bsFlag == 'S') tempValue = -tempValue
              if (tempValue >= Store['盈利比例卖出数值']) {
                list.forEach((item2) => {
                  logBox.add(`满足自动卖出要求【全仓止盈】`)
                  pingcang(item2, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                })
              }
              return
            }
            list.forEach((item) => {
              let 持仓成本 = item.singlePrice 
              let tempValue = (parseInt(持仓成本) - parseInt(window['当前价'])) / parseInt(持仓成本)
              // 做空
              if (item.bsFlag == 'S') tempValue = -tempValue
              if (tempValue >= Store['盈利比例卖出数值']) {
                // 判断止盈方式
                if (Store['止盈方式'] == '每单单独止盈') {
                  logBox.add(`满足自动卖出要求【盈利: ${(parseInt(持仓成本) - parseInt(window['当前价']))}】/ 成本: ${持仓成本}】> ${Store['盈利比例卖出数值']} 自动卖出!`)
                  // 平仓单独的
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
                if (Store['止盈方式'] == '全仓止盈') {
                  list.forEach((item2) => {
                    logBox.add(`满足自动卖出要求【全仓止盈】`)
                    pingcang(item2, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                  })
                }
              }
            })
          })
        }

        if (Store['止盈点位'] === '固定金额止盈' && window['当前持仓数'] > 0) {
          if (parseInt(window['当前价']) > Store['固定金额止盈']) {
            cdmx((list) => {
              list.forEach((item) => {
                if (item.singlePrice  < parseInt(window['当前价']) && item.bsFlag == 'B') {
                  logBox.add(`满足自动卖出要求【固定金额止盈】- 当前价: ${window['当前价']}】 自动卖出!`)
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
                if (item.singlePrice  > parseInt(window['当前价']) && item.bsFlag == 'S') {
                  logBox.add(`满足自动卖出要求【固定金额止盈】- 当前价: ${window['当前价']}】 自动卖出!`)
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
              })
            })
          }
        }

        if (Store['止盈点位'] === '移动止盈' && window['当前持仓数'] > 0) {
          // 取出最后五个价格
          let priceArrTemp = window['价格信息'].priceArr.filter(function(value) {
            return value !== null && value !== undefined && value !== '';
          });
          priceArrTemp = priceArrTemp.slice(-5)
          // 获取最大值
          const priceArrMax = Math.max(...priceArrTemp);
          
          // 获取最小值
          const priceArrMin = Math.min(...priceArrTemp);
          for (let index = 0; index < window['当前持仓'].length; index++) {
            const element = window['当前持仓'][index];
            let 移动止盈数值 = Store['移动止盈数值']
            移动止盈数值 = 移动止盈数值.replaceAll('：', ":")
            if (移动止盈数值.includes(':')) {
              移动止盈数值 = 移动止盈数值.split(':')
              if (移动止盈数值[index]) 移动止盈数值 = 移动止盈数值[index]
              else 移动止盈数值 = 移动止盈数值[0]
            }
            移动止盈数值 = parseInt(移动止盈数值)
            // 做多
            if (element.bsFlag == 'B') {
              if (priceArrTemp[4] < priceArrMax && priceArrTemp[4] > element.initPrice && (priceArrMax - priceArrTemp[4]) >=  移动止盈数值) {
                logBox.add(`触发移动止盈 当前价${window['当前价']} 最高价${priceArrMax}!`)
                pingcang(element, document.querySelector('.good_msg_v').innerText, element.availableQuantity)
              }
            } else {
              if (priceArrTemp[4] > priceArrMin && priceArrTemp[4] < element.initPrice && (priceArrTemp[4] - priceArrMin) >=  移动止盈数值) {
                logBox.add(`触发移动止盈 当前价${window['当前价']} 最低价${priceArrMin}!`)
                pingcang(element, document.querySelector('.good_msg_v').innerText, element.availableQuantity)
              }
            }
          }
        }

        if (Store['止损点位'] === '亏损达到X卖出' && window['当前持仓数'] > 0) {
          cdmx((list) => {
            if (Store['止损方式'] == '每单单独止损') {
              list.forEach((item) => {
                let 持仓成本 = item.singlePrice
                let tempValue = parseInt(window['当前价']) - parseInt(持仓成本)
                // 做空
                if (item.bsFlag == 'S') tempValue = -tempValue
                if (parseInt(Store['固定点位止损']) > 0) Store['固定点位止损'] = -parseInt(Store['固定点位止损'])
                if (tempValue <= parseInt(Store['固定点位止损'])) {
                  // 判断止损方式
                  logBox.add(`满足自动卖出要求【持仓成本: ${持仓成本}】- 当前价: ${window['当前价']}】= 【${tempValue}】< ${Store['固定点位止损']} 自动卖出!`)
                  // 平仓单独的
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
              })
            }
            
            if (Store['止损方式'] == '首单全仓止损') {
              let item = list[list.length - 1]
              let 持仓成本 = item.singlePrice
              let tempValue = parseInt(window['当前价']) - parseInt(持仓成本)
              // 做空
              if (item.bsFlag == 'S') tempValue = -tempValue
              if (parseInt(Store['固定点位止损']) > 0) Store['固定点位止损'] = -parseInt(Store['固定点位止损'])
              if (tempValue <= parseInt(Store['固定点位止损'])) {
                logBox.add(`满足自动卖出要求【首单全仓止损】`)
                list.forEach((item2) => {
                  pingcang(item2, document.querySelector('.good_msg_v').innerText, item2.availableQuantity)
                })
              }
            }
            
          })
        }
        if (Store['止损点位'] === '亏损比例X卖出' && window['当前持仓数'] > 0) {
          cdmx((list) => {
            if (Store['止损方式'] == '每单单独止损') {
              list.forEach((item) => {
                let 持仓成本 = item.singlePrice 
                let tempValue = -((parseInt(持仓成本) - parseInt(window['当前价'])) / parseInt(持仓成本))
                // 做空
                if (item.bsFlag == 'S') tempValue = -tempValue
                if (tempValue <= Store['亏损比例卖出数值']) {
                  // 判断止损方式
                  logBox.add(`满足自动卖出要求【亏损: ${-(parseInt(持仓成本) - parseInt(window['当前价']))}】/ 成本: ${持仓成本}】< ${Store['亏损比例卖出数值']} 自动卖出!`)
                  // 平仓单独的
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                } else {
                  logBox.add(`当前【${tempValue}】【盈利: ${-(parseInt(持仓成本) - parseInt(window['当前价']))}】/ 持仓成本: ${持仓成本}】< ${Store['亏损比例卖出数值']} `)
                }
              })
            }
            if (Store['止损方式'] == '首单全仓止损') {
              let item = list[list.length - 1]
              let 持仓成本 = item.singlePrice 
              let tempValue = -((parseInt(持仓成本) - parseInt(window['当前价'])) / parseInt(持仓成本))
              // 做空
              if (item.bsFlag == 'S') tempValue = -tempValue
              if (tempValue <= Store['亏损比例卖出数值']) {
                logBox.add(`满足自动卖出要求【首单全仓止损】`)
                list.forEach((item2) => {
                  pingcang(item2.holdDetailId, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                })
              }
            }
          })
        }

        if (Store['止损点位'] === '固定金额止损' && window['当前持仓数'] > 0) {
          if (parseInt(window['当前价']) > Store['固定金额止损']) {
            cdmx((list) => {
              list.forEach((item) => {
                if (item.singlePrice  > parseInt(window['当前价']) && item.bsFlag == 'B') {
                  logBox.add(`满足自动卖出要求【固定金额止损】- 当前价: ${window['当前价']}】 自动卖出!`)
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
                if (item.singlePrice  < parseInt(window['当前价']) && item.bsFlag == 'S') {
                  logBox.add(`满足自动卖出要求【固定金额止损】- 当前价: ${window['当前价']}】 自动卖出!`)
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
              })
            })
          } else {
            cdmx((list) => {
              list.forEach((item) => {
                if (item.singlePrice  < parseInt(window['当前价']) && item.bsFlag == 'B') {
                  logBox.add(`满足自动卖出要求【固定金额止损】- 当前价: ${window['当前价']}】 自动卖出!`)
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
                if (item.singlePrice  > parseInt(window['当前价']) && item.bsFlag == 'S') {
                  logBox.add(`满足自动卖出要求【固定金额止损】- 当前价: ${window['当前价']}】 自动卖出!`)
                  pingcang(item, document.querySelector('.good_msg_v').innerText, item.availableQuantity)
                }
              })
            })
          }
        }
        if ((window['当前委托数'] + window['当前持仓数']) > parseInt(Store['开单次数'])) {
          return
        }
        // 首先判断趋势指标是否开启
        if (Store['自动交易开启'] === true) {
          switch (Store['趋势指标选择']) {
            case "均线":
              // 先判断价差
              if (Store['开单价差'] != 0 && window['当前持仓数'] >= 1) {
                
                let last = window['当前持仓'][window['当前持仓'].length - 1]
                if (last.bsFlag == 'B' && window['当前价'] >= (last['initPrice'] + Store['开单价差'])) {
                  tradeMake ('B', null, null)
                }
                if (last.bsFlag == 'S' && window['当前价'] <= (last['initPrice'] - Store['开单价差'])) {
                  tradeMake ('S', null, null)
                }
                return
              }
              if (Store['均线'] == 'k线在均线上方做多') {
                if (当前均价 < (window['当前价'])) {
                  dqjg()
                  logBox.add(`达到自动下单要求【k线在均线上方做多】【均价: ${当前均价}】 当前价: ${window['当前价']}】 自动做多【${Store['开单手数']}】手`)
                  tradeMake ('B', null, null)
                } else {
                  if (Store['显示详细日志']) {
                    logBox.add(`不满足自动下单要求【k线在均线上方做多】【均价: ${当前均价}】 当前价: ${window['当前价']}】 当前价:${window['当前价']} 均价:${当前均价}`)
                  }
                }
              }
              if (Store['均线'] == 'k线在均线上方做空') {
                if (当前均价 < (window['当前价'])) {
                  dqjg()
                  logBox.add(`达到自动下单要求【k线在均线上方做空】【均价: ${当前均价}】 当前价: ${window['当前价']}】 自动做空【${Store['开单手数']}】手`)
                  tradeMake ('S', null, null)
                } else {
                  if (Store['显示详细日志']) {
                    logBox.add(`不满足自动下单要求【k线在均线上方做空】要求 当前价:${window['当前价']} 均价:${当前均价}`)
                  }
                }
              }
              if (Store['均线'] == 'k线在均线下方做空') {
                if (当前均价 > (window['当前价'])) {
                  dqjg()
                  logBox.add(`达到自动下单要求【k线在均线下方做空】【均价: ${当前均价}】 当前价: ${window['当前价']}】 自动做空【${Store['开单手数']}】手`)
                  tradeMake ('S', null, null)
                } else {
                  if (Store['显示详细日志']) {
                    logBox.add(`不满足自动下单要求【k线在均线下方做空】要求 当前价:${window['当前价']} 均价:${当前均价}`)
                  }
                }
              }
              if (Store['均线'] == 'k线在均线下方做多') {
                if (当前均价 > (window['当前价'])) {
                  dqjg()
                  // logBox.add(`达到自动下单要求【k线在均线下方做多】【均价: ${当前均价}】 当前价: ${window['当前价']}】 自动做多【${Store['开单手数']}】手`)
                  tradeMake ('B', null, null)
                } else {
                  if (Store['显示详细日志']) {
                    logBox.add(`不满足自动下单要求【k线在均线下方做多】【均价: ${当前均价}】 当前价: ${window['当前价']}】 当前价:${window['当前价']} 均价:${当前均价}`)
                  }
                }
              }
              break
            case '实时开仓':
                dqjg()
                // logBox.add(`实时开仓 当前价: ${window['当前价']}】 自动做多【${Store['开单手数']}】手`)
                console.log(Store['实时开仓方式'] == '1阴1阳开多', window['标线阴阳'] == '阳线', parseInt(window['标线连续']))
                function checkBZKXnum (n) {
                  let bzkx = true
                  for (let index = window['标线阴阳列表'].length - 1; index > window['标线阴阳列表'].length - 1 - n; index--) {
                    const element = array[index];
                    if (element == '非标准k线') bzkx = false
                  }
                  return bzkx
                }
                
                // 判断走势
                if (Store['实时开仓方式'] == '阴线开空' && window['标线阴阳'] == '阴线' && parseInt(window['标线连续']) >= parseInt(Store['多少次连续时下单'])) {
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('S', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                }
                if (Store['实时开仓方式'] == '阴线开多' && window['标线阴阳'] == '阴线' && parseInt(window['标线连续']) >= parseInt(Store['多少次连续时下单'])) {
                  
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('B', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                }
                if (Store['实时开仓方式'] == '阳线开空' && window['标线阴阳'] == '阳线' && parseInt(window['标线连续']) >= parseInt(Store['多少次连续时下单'])) {
                  
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('S', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                }
                if (Store['实时开仓方式'] == '阳线开多' && window['标线阴阳'] == '阳线' && parseInt(window['标线连续']) >= parseInt(Store['多少次连续时下单'])) {
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('B', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                }
                if (Store['实时开仓方式'] == '1阴1阳开多' && window['标线阴阳'] == '阳线' && parseInt(window['标线连续']) == 1) {
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('B', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                }
                if (Store['实时开仓方式'] == '1阴2阳开多' && window['标线阴阳'] == '阳线' && parseInt(window['标线连续']) == 2) {
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('B', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                  
                }
                if (Store['实时开仓方式'] == '1阳1阴开空' && window['标线阴阳'] == '阴线' && parseInt(window['标线连续']) == 1) {
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('S', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                  
                }
                if (Store['实时开仓方式'] == '1阳2阴开空' && window['标线阴阳'] == '阴线' && parseInt(window['标线连续']) == 2) {
                  if (checkBZKXnum(parseInt(Store['多少次连续时下单']))) {
                    tradeMake ('S', null, null)
                  } else {
                    logBox.add(`不全部满足标准K线 忽略下单`)
                  }
                  
                }
              break
          }
        }
        
      }
      setTimeout(() => {
        loadStore()
        initSwitchControl()
        cdmx()
        cxwt()
      }, 500);
      function qlwt() {
        fetch("https://yw.ceramic-copyright.cn/apigateway/intraday-trade/trade/cancelAll", {
            "headers": getHeaders(),
            "referrerPolicy": "strict-origin-when-cross-origin",
            "body": JSON.stringify({}),
            "method": "POST",
          }).then((response) => response.json())
            .then((result) => {
              logBox.add(`定时清理委托成功!`)
            })
            .catch((error) => console.error(error));
      }
      // 定期取消
      setInterval(() => {
        
        // logBox.add(`定时清理委托成功!`)
        cdmx()
        cxwt()
        loadStore()
        setTimeout(() => {
          initSwitchControl()
        }, 200);
      }, 120 * 1000);
    </script>
  </body>

</html>